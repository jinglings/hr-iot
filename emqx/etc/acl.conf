# EMQX ACL Configuration for HR-IoT
# Access Control List for Multi-Tenant Topic Isolation

# Admin can access all topics
{allow, {user, "admin"}, pubsub, ["#"]}.

# HR-IoT Backend Service
# Publish to device property topics
{allow, {user, "hr-iot-backend"}, publish, ["iot/+/device/+/properties"]}.
{allow, {user, "hr-iot-backend"}, publish, ["iot/+/device/+/events"]}.

# Subscribe to control command topics
{allow, {user, "hr-iot-backend"}, subscribe, ["iot/+/device/+/control"]}.

# FUXA Server
# Subscribe to all device topics (filtered by tenant in application logic)
{allow, {user, "fuxa-server"}, subscribe, ["iot/+/device/+/properties"]}.
{allow, {user, "fuxa-server"}, subscribe, ["iot/+/device/+/events"]}.
{allow, {user, "fuxa-server"}, subscribe, ["iot/+/alarms"]}.

# Publish control commands
{allow, {user, "fuxa-server"}, publish, ["iot/+/device/+/control"]}.

# Devices (authenticated with device credentials)
# Each device can only publish to its own topics
# Pattern: iot/{tenant_id}/device/{device_id}/properties
{allow, {user, "device-${deviceId}"}, publish, ["iot/${tenantId}/device/${deviceId}/properties"]}.
{allow, {user, "device-${deviceId}"}, publish, ["iot/${tenantId}/device/${deviceId}/events"]}.

# Devices can subscribe to their own control topics
{allow, {user, "device-${deviceId}"}, subscribe, ["iot/${tenantId}/device/${deviceId}/control"]}.

# Deny all other access
{deny, all}.
