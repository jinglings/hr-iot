# 能源管理模块 - 前后端联调测试清单

## 📋 测试准备

### 1. 环境检查
- [ ] 后端服务已启动（默认端口: 48080）
- [ ] 前端服务已启动（默认端口: 80）
- [ ] 数据库已连接并初始化
- [ ] Redis服务已启动
- [ ] 用户已登录系统

### 2. 权限配置
确保测试用户具有以下权限：
```
iot:energy-building:query
iot:energy-building:create
iot:energy-building:update
iot:energy-building:delete

iot:energy-area:query
iot:energy-area:create
iot:energy-area:update
iot:energy-area:delete

iot:energy-floor:query
iot:energy-floor:create
iot:energy-floor:update
iot:energy-floor:delete

iot:energy-room:query
iot:energy-room:create
iot:energy-room:update
iot:energy-room:delete

iot:energy-type:query
iot:energy-type:create
iot:energy-type:update
iot:energy-type:delete

iot:energy-meter:query
iot:energy-meter:create
iot:energy-meter:update
iot:energy-meter:delete

iot:energy-data:query
iot:energy-statistics:query
iot:energy-dashboard:query
iot:energy-analysis:query

iot:energy-report-template:query
iot:energy-report-template:create
iot:energy-report-template:update
iot:energy-report-template:delete

iot:energy-report-record:query
iot:energy-report-record:create
iot:energy-report-record:delete
iot:energy-report-record:export
```

---

## 🧪 功能测试清单

### 第一模块：空间层级管理

#### 1.1 建筑管理 (/iot/energy/space/building)

**API路径**: `/iot/energy/building`

- [ ] **列表查询**
  - 访问建筑管理页面
  - 验证列表数据加载
  - 测试分页功能
  - 测试搜索功能（名称、编码、类型、状态）
  - 测试日期范围筛选

- [ ] **新增建筑**
  - 点击"新增"按钮
  - 填写表单（必填项：名称、编码、类型）
  - 上传建筑图片
  - 填写经纬度、面积、楼层数
  - 提交并验证成功提示
  - 验证列表刷新

- [ ] **编辑建筑**
  - 点击"编辑"按钮
  - 修改建筑信息
  - 提交并验证更新成功

- [ ] **删除建筑**
  - 点击"删除"按钮
  - 确认删除提示
  - 验证删除成功

- [ ] **导出Excel**
  - 点击"导出"按钮
  - 验证文件下载成功

#### 1.2 区域管理 (/iot/energy/space/area)

**API路径**: `/iot/energy/area`

- [ ] **列表查询**
  - 访问区域管理页面
  - 验证列表数据加载
  - 测试按建筑筛选

- [ ] **新增区域**
  - 选择所属建筑
  - 填写区域名称、编码
  - 提交并验证

- [ ] **编辑/删除区域**
  - 测试编辑功能
  - 测试删除功能

#### 1.3 楼层管理 (/iot/energy/space/floor)

**API路径**: `/iot/energy/floor`

- [ ] **列表查询**
  - 访问楼层管理页面
  - 验证建筑、区域、楼层信息显示

- [ ] **新增楼层**
  - 选择建筑
  - 选择区域（可选）
  - 填写楼层编号（支持负数）
  - 填写楼层面积
  - 提交并验证

- [ ] **级联加载测试**
  - 验证选择建筑后区域列表更新
  - 验证选择区域后楼层过滤

#### 1.4 房间管理 (/iot/energy/space/room)

**API路径**: `/iot/energy/room`

- [ ] **列表查询**
  - 访问房间管理页面
  - 验证四级层级显示（建筑/区域/楼层/房间）

- [ ] **新增房间**
  - 选择建筑
  - 选择区域
  - 选择楼层
  - 填写房间信息（名称、编码、类型、面积）
  - 测试房间类型标签显示

- [ ] **三级级联测试**
  - 验证建筑→区域→楼层级联
  - 验证取消区域选择后显示所有楼层

---

### 第二模块：能源配置管理

#### 2.1 能源类型管理 (/iot/energy/config/type)

**API路径**: `/iot/energy/type`

- [ ] **树形列表**
  - 访问能源类型页面
  - 验证树形结构展示
  - 测试展开/折叠功能

- [ ] **新增能源类型**
  - 点击"新增"按钮
  - 选择父级能源类型
  - 填写类型信息：
    * 名称、编码
    * 计量单位（kWh/m³/t/L/Nm³）
    * 折标煤系数
    * 碳排放系数
    * 图标、颜色
  - 提交并验证树形结构更新

- [ ] **编辑/删除**
  - 测试编辑功能
  - 测试删除功能
  - 验证有子节点时的删除限制

#### 2.2 计量点管理 (/iot/energy/config/meter)

**API路径**: `/iot/energy/meter`

- [ ] **列表查询**
  - 访问计量点页面
  - 测试多维度筛选（名称、编码、能源类型、建筑、级别、虚拟表）

- [ ] **新增物理表**
  - 填写基本信息
  - 选择能源类型
  - 设置虚拟表开关为"否"
  - 远程搜索并选择设备
  - 选择设备属性
  - 选择空间位置（建筑→区域→楼层→房间）
  - 设置计量点级别
  - 选择父级计量点（可选）
  - 设置计量倍率
  - 提交并验证

- [ ] **新增虚拟表**
  - 设置虚拟表开关为"是"
  - 验证设备绑定字段隐藏
  - 填写计算公式
  - 验证表单验证规则切换
  - 提交并验证

- [ ] **编辑计量点**
  - 测试物理表编辑
  - 测试虚拟表编辑
  - 验证级联数据加载

---

### 第三模块：数据查询与统计

#### 3.1 能源数据查询 (/iot/energy/query/data)

**API路径**: `/iot/energy/data`

- [ ] **数据查询**
  - 选择计量点
  - 选择时间范围
  - 选择能源类型、建筑（可选）
  - 点击搜索
  - 验证表格数据展示：
    * 时间、计量点、能源类型
    * 建筑、区域、楼层、房间
    * 瞬时功率、累计值
    * 电压、电流、功率因数
    * 数据质量标签

- [ ] **图表展示**
  - 点击"查看图表"
  - 验证必填项提示
  - 选择聚合间隔（1分钟/1小时/1天）
  - 验证折线图展示：
    * 平均值、最大值、最小值
    * 时间轴正确
  - 测试间隔切换

- [ ] **分页测试**
  - 测试分页功能
  - 测试每页条数切换

#### 3.2 能源统计分析 (/iot/energy/query/statistics)

**API路径**: `/iot/energy/statistics`

- [ ] **统计维度切换**
  - 测试"按计量点统计"
  - 测试"按建筑统计"
  - 测试"按能源类型统计"
  - 验证对应筛选项显示

- [ ] **统计周期**
  - 选择统计周期（小时/天/月/年）
  - 选择时间范围
  - 点击搜索
  - 验证表格数据：
    * 周期、总能耗、单位
    * 平均功率、最大/最小功率
    * 折标煤、碳排放

- [ ] **统计分析图表**
  - 点击"统计分析"
  - 验证必填项校验
  - 查看能耗趋势图（双Y轴）
  - 查看能耗占比饼图
  - 查看折标煤与碳排放柱状图

---

### 第四模块：可视化与报表

#### 4.1 能源仪表板 (/iot/energy/visual/dashboard)

**API路径**: `/iot/energy/dashboard`

- [ ] **总览卡片**
  - 验证4个卡片展示：
    * 总能耗（含日环比）
    * 总标煤（含月环比）
    * 碳排放
    * 总费用（含在线/离线/告警统计）
  - 验证渐变色背景
  - 验证数值格式化

- [ ] **能耗趋势图**
  - 测试时间范围切换（24h/7d/30d）
  - 验证三条曲线：能耗值、标煤值、碳排放值
  - 验证双Y轴显示

- [ ] **分项能耗饼图**
  - 验证各能源类型占比
  - 验证颜色展示

- [ ] **能耗排名TOP10**
  - 测试维度切换（建筑/计量点）
  - 验证前三名特殊高亮
  - 验证百分比进度条

- [ ] **实时监控**
  - 验证实时功率曲线
  - 等待1分钟验证自动刷新

#### 4.2 报表模板管理 (/iot/energy/report/template)

**API路径**: `/iot/energy/report/template`

- [ ] **列表查询**
  - 访问报表模板页面
  - 测试搜索（名称、编码、类型、状态）

- [ ] **新增模板（可视化配置）**
  - 填写基本信息（名称、编码、类型）
  - 切换到"可视化配置"标签页
  - 勾选包含字段
  - 勾选统计维度
  - 勾选图表类型
  - 选择时间粒度
  - 设置是否包含对比
  - 提交并验证JSON自动生成

- [ ] **新增模板（JSON配置）**
  - 切换到"JSON配置"标签页
  - 直接编辑JSON
  - 提交并验证

- [ ] **查看配置**
  - 点击"查看配置"
  - 验证JSON格式化显示

- [ ] **编辑/删除模板**
  - 测试编辑功能
  - 验证配置解析到可视化界面
  - 测试删除功能

#### 4.3 报表记录管理 (/iot/energy/report/record)

**API路径**: `/iot/energy/report/record`

- [ ] **生成报表**
  - 点击"生成报表"
  - 选择报表模板
  - 填写报表名称
  - 选择统计时间范围
  - 选择建筑（可选）
  - 点击"开始生成"
  - 验证异步生成提示

- [ ] **列表查询**
  - 刷新列表
  - 验证报表状态（生成中/成功/失败）
  - 测试多条件筛选

- [ ] **查看报表数据**
  - 点击"查看数据"
  - 验证报表详情展示
  - 验证JSON数据格式化

- [ ] **导出功能**
  - 点击"导出Excel"
  - 验证文件下载
  - 点击"导出PDF"
  - 验证文件下载
  - 验证未成功状态时按钮禁用

- [ ] **删除报表**
  - 测试删除功能

---

### 第五模块：能效分析

#### 5.1 能效分析 (/iot/energy/analysis/efficiency)

**API路径**: `/iot/energy/analysis`

- [ ] **查询条件**
  - 选择建筑
  - 选择能源类型
  - 选择时间范围
  - 点击"开始分析"

- [ ] **同比环比分析**
  - 测试同比/环比切换
  - 验证对比卡片：
    * 当前值与对比值
    * 增长率标签颜色
    * 上升/下降图标
  - 验证对比趋势柱状图

- [ ] **能效指标评估**
  - 切换指标类型：
    * 单位面积能耗
    * 人均能耗
    * 单位产值能耗
  - 验证表格数据：
    * 实际值、基准值、偏离率
  - 验证对比图表

- [ ] **碳排放计算**
  - 验证总览卡片：
    * 总碳排放量
    * 折标煤当量
    * 需种植树木数量
  - 验证明细表格：
    * 能源类型、总能耗
    * 碳排放系数、碳排放量
    * 占比
  - 验证碳排放饼图

---

### 第六模块：公共组件测试

#### 6.1 SpaceTreeSelect - 空间树选择器

在任意使用该组件的页面测试：

- [ ] **基本功能**
  - 验证树形结构展示
  - 测试节点展开/收起
  - 测试搜索功能

- [ ] **级联加载**
  - 验证异步加载子节点
  - 验证不同级别限制（building/area/floor/room/all）

- [ ] **图标显示**
  - 验证不同层级图标不同

#### 6.2 MeterSelect - 计量点选择器

- [ ] **基本功能**
  - 测试单选模式
  - 测试多选模式
  - 测试远程搜索

- [ ] **条件过滤**
  - 测试按能源类型过滤
  - 测试按建筑过滤
  - 测试只显示虚拟表

- [ ] **详细信息**
  - 验证计量点名称、编码显示
  - 验证能源类型显示
  - 验证虚拟表标签

#### 6.3 EnergyTypeSelect - 能源类型选择器

- [ ] **基本功能**
  - 验证树形结构
  - 测试单选/多选
  - 测试搜索功能

- [ ] **叶子节点限制**
  - 测试onlyLeaf模式
  - 验证父节点禁用

- [ ] **额外信息**
  - 验证图标和颜色显示
  - 验证单位标签

---

## 🔧 常见问题排查

### 1. API调用失败
**检查项**:
- [ ] 后端服务是否正常运行
- [ ] API路径是否正确（已修复为 `/iot/energy/xxx`）
- [ ] 请求参数格式是否正确
- [ ] 浏览器控制台查看具体错误信息

### 2. 权限不足
**检查项**:
- [ ] 用户是否具有对应权限
- [ ] 后台菜单权限配置是否正确
- [ ] 按钮权限指令 `v-hasPermi` 是否配置

### 3. 级联选择器不工作
**检查项**:
- [ ] 父级数据是否正确加载
- [ ] API接口是否返回正确数据
- [ ] 控制台是否有JavaScript错误

### 4. 图表不显示
**检查项**:
- [ ] ECharts是否正确引入
- [ ] 数据格式是否正确
- [ ] 图表容器尺寸是否正常

### 5. 文件导出失败
**检查项**:
- [ ] 后端导出接口是否实现
- [ ] 浏览器是否允许下载
- [ ] 文件格式是否正确

---

## 📊 测试报告模板

### 测试概况
- 测试时间：____年__月__日
- 测试人员：________
- 测试环境：开发/测试/生产
- 前端版本：________
- 后端版本：________

### 测试结果统计
- 总测试项：___ 项
- 通过：___ 项
- 失败：___ 项
- 阻塞：___ 项
- 通过率：___%

### 问题列表
| 序号 | 模块 | 问题描述 | 严重程度 | 状态 |
|------|------|----------|----------|------|
| 1 | | | 高/中/低 | 待修复/已修复 |

### 建议与备注

---

## ✅ 验收标准

### 功能完整性
- [ ] 所有13个功能模块可访问
- [ ] 所有CRUD操作正常
- [ ] 所有查询筛选功能正常
- [ ] 所有图表正常显示

### 性能要求
- [ ] 列表加载时间 < 2秒
- [ ] 图表渲染时间 < 1秒
- [ ] 表单提交响应时间 < 1秒
- [ ] 文件导出时间 < 5秒

### 用户体验
- [ ] 操作流程顺畅
- [ ] 错误提示友好
- [ ] 加载状态清晰
- [ ] 界面美观一致

### 数据准确性
- [ ] 统计数据准确
- [ ] 图表数据一致
- [ ] 导出数据完整
- [ ] 计算结果正确

---

**测试完成后，请填写测试报告并反馈问题！**
